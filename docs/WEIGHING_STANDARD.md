# 산업용 계량 인디케이터 연동 표준 가이드

본 문서는 A&D NEW-4321 PLUS 등 산업용 계량 인디케이터와 본 웹 시스템 간의 실시간 연동을 위한 표준 규격을 정의합니다. 향후 추가 개발 및 유지보수 시 본 규격을 반드시 준수해야 합니다.

## 1. 하드웨어 통신 설정 (Serial Port)

안정적인 실시간 데이터 수신을 위해 다음과 같은 통신 설정을 고수합니다.

| 항목 | 설정값 | 비고 |
| :--- | :--- | :--- |
| **Port** | `COM3` (가변 가능) | 환경변수 `COM_PORT`로 관리 |
| **Baud Rate** | `2400` bps | 인디케이터 속도와 일치 필수 |
| **Data Bits** | `7` bits | 7비트 규격 사용 |
| **Parity** | `Even` (짝수) | - |
| **Stop Bits** | `1` bit | - |

## 2. 인디케이터 출력 모드 (F9 설정)

실시간 중량 변화를 웹 화면에 즉각적으로 반영하기 위해 인디케이터의 출력 모드는 반드시 **Stream Mode**여야 합니다.

- **권장 설정**: `F9 = 0` (Stream Mode / 연속 출력)
- **미준수 시 증상**: 중량이 변화해도 웹 화면의 숫자가 멈춰있거나, 특정 이벤트(버튼 클릭 등) 시에만 값이 갱신됨.

## 3. 데이터 패킷 포맷 및 파싱 (Protocol)

본 시스템은 다음과 같은 표준 A&D 7바이트/17바이트 공통 포맷을 처리합니다.

### 팩킷 예시
`ST,GS,+000012.34Kg<CR><LF>`

### 파싱 규칙 (AND4321Parser)
1. **Header (2항목)**: 
   - `ST`: Stable (안정)
   - `UN`: Unstable (측정 중)
   - `OL`: Overload (과적)
2. **Weight Data**:
   - 부호(`+`/`-`)를 포함한 숫자값 추출.
   - 단위(`kg`, `g` 등) 분리.
3. **처리 원칙**:
   - 수신된 모든 패킷은 SSE(Server-Sent Events)를 통해 즉시 UI로 전송함.
   - UI는 마지막으로 수신된 유효한 패킷의 중량값을 표시함.

## 4. 개발 시 주의사항

- **중복 처리 금지**: 동일한 중량값이 연속으로 들어오더라도, 시스템은 살아있음을 알리기 위해 매번 UI에 이벤트를 전달하는 것을 원칙으로 함 (Heartbeat 역할).
- **보안 설정**: `.env.local` 파일에 포트 정보를 관리하며, 실제 하드웨어가 연결되지 않은 환경(Vercel 등)에서는 500 에러 대신 안내 메시지를 표시하도록 처리함.
